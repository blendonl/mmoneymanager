model Store {
  id String @id @default(uuid())

  name     String
  location String

  items    StoreItem[]
  expenses Expense[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("store")
}

model Item {
  id         String @id @default(uuid())
  categoryId String @map("category_id")

  name String

  category ItemCategory @relation(fields: [categoryId], references: [id])
  stores   StoreItem[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("item")
}

model StoreItem {
  id      String @id @default(uuid())
  itemId  String @map("item_id")
  storeId String @map("store_id")

  price        Decimal
  isDiscounted Boolean @map("is_discounted")

  store     Store               @relation(fields: [storeId], references: [id])
  item      Item                @relation(fields: [itemId], references: [id])
  discounts StoreItemDiscount[]
  expenses  ExpenseItem[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("store_item")
}

model StoreItemDiscount {
  id          String @id
  storeItemId String @map("store_item_id")

  discount  Decimal
  startedAt DateTime  @default(now()) @map("started_at")
  endedAt   DateTime? @map("ended_at")

  storeItem StoreItem @relation(fields: [storeItemId], references: [id])

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("store_item_discount")
}

model ItemCategory {
  id       String  @id @default(uuid())
  parentId String? @map("parent_id")

  name String

  parent   ItemCategory?  @relation(name: "children", fields: [parentId], references: [id])
  children ItemCategory[] @relation(name: "children")
  items    Item[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("item_category")
}
